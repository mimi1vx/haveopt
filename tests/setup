. haveopt.sh

tool()
{
  if [ "x$tool" = xgetopts ]; then
    local ex=0 name OPTARG optspec="$1"; shift
    getopts "$optspec" name "$@" || ex=$?
    printf "I=%d\nN=%s\nA=%s\n" $OPTIND "$name" "$OPTARG"
    return $ex
  else
    local ex=0 p="${channels-}" os="${optspecs-}"
    haveopt $p $os -- "$@" || ex=$?
    dump $p
    return $ex
  fi
}

dump()
{
  # the isset trickery serves to distinguish between
  # set-and-empty vs unset parameters.
  local isset var val
  for var; do
    eval val="\"\${$var-}\""
    eval "isset=\${$var+<empty>}"
    printf "%s=%s\n" "$var" "${val:-$isset}"
  done
}
